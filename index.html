<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TPAO Petroleum Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>

<!-- Overlay -->
<div id="overlay" onclick="closeSidebar()"></div>

<!-- Menu Button -->
<button class="menu-btn" onclick="toggleSidebar()">☰</button>

<!-- Sidebar -->
<aside class="sidebar" id="sidebar">
  <h2 class="logo">TPAO</h2>
  <nav>
    <a class="active" onclick="navigate('dashboard')">Dashboard</a>
    <a onclick="navigate('production')">Production</a>
    <a onclick="navigate('map')">Oil Fields</a>
  </nav>
</aside>

<!-- Main -->
<main class="main">

  <!-- DASHBOARD -->
  <section id="dashboard" class="page active">

    <!-- Banner -->
    <div class="banner">
      <img src="images/tpao-banner.jpg" alt="TPAO Operations">
      <div class="banner-text">
        <h1>TPAO Petroleum Dashboard</h1>
        <p>Türkiye Petrolleri Anonim Ortaklığı – Energy Operations Overview</p>
      </div>
    </div>

    <!-- Cards -->
    <div class="cards">
      <div class="card">
        <img src="images/oil-field.jpg" alt="Oil Field">
        <h3>Daily Production</h3>
        <p>1.45M bbl</p>
      </div>

      <div class="card">
        <img src="images/refinery.jpg" alt="Refinery">
        <h3>Active Fields</h3>
        <p>37</p>
      </div>

      <div class="card">
        <img src="images/offshore.jpg" alt="Offshore">
        <h3>Countries</h3>
        <p>6</p>
      </div>

      <div class="card">
        <img src="images/oil-field.jpg" alt="Revenue">
        <h3>Revenue</h3>
        <p>$18.2B</p>
      </div>
    </div>

  </section>

  <!-- PRODUCTION -->
  <section id="production" class="page">
    <h1>Oil Production</h1>
    <canvas id="productionChart"></canvas>
  </section>

  <!-- MAP -->
  <section id="mapPage" class="page">
    <h1>TPAO Oil Fields</h1>
    <div id="map"></div>
  </section>

</main>

<script>
/* ===== STATE ===== */
let currentPage = 'dashboard';

/* ===== ELEMENTS ===== */
const sidebar = document.getElementById('sidebar');
const overlay = document.getElementById('overlay');

/* ===== INITIAL STATE ===== */
history.replaceState({ type: 'page', page: 'dashboard' }, '', '#dashboard');

/* ===== SIDEBAR ===== */
function toggleSidebar() {
  sidebar.classList.add('show');
  overlay.classList.add('show');
  history.pushState({ type: 'sidebar', page: currentPage }, '', '#menu');
}

function closeSidebar() {
  sidebar.classList.remove('show');
  overlay.classList.remove('show');
}

/* ===== NAVIGATION ===== */
function navigate(page) {
  currentPage = page;
  showPage(page);
  closeSidebar();
  history.pushState({ type: 'page', page }, '', `#${page}`);
}

/* ===== SHOW PAGE ===== */
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));

  if (page === 'map') {
    document.getElementById('mapPage').classList.add('active');
    setTimeout(initMap, 300);
  } else {
    document.getElementById(page).classList.add('active');
  }

  document
    .querySelector(`.sidebar a[onclick="navigate('${page}')"]`)
    ?.classList.add('active');
}

/* ===== BACK BUTTON ===== */
window.addEventListener('popstate', (e) => {
  if (!e.state) return;

  if (e.state.type === 'sidebar') {
    sidebar.classList.add('show');
    overlay.classList.add('show');
    currentPage = e.state.page;
    return;
  }

  if (e.state.type === 'page') {
    closeSidebar();
    showPage(e.state.page);
    currentPage = e.state.page;
  }
});

/* ===== CHART ===== */
new Chart(document.getElementById('productionChart'), {
  type: 'line',
  data: {
    labels: ['Jan','Feb','Mar','Apr','May','Jun'],
    datasets: [{
      label: 'Barrels / Day',
      data: [120,135,140,150,145,160],
      borderColor: '#22c55e',
      tension: 0.4
    }]
  }
});

/* ===== MAP ===== */
let mapLoaded = false;
function initMap() {
  if (mapLoaded) return;
  mapLoaded = true;

  const map = L.map('map').setView([39, 35], 5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

  L.marker([37.88, 41.13]).addTo(map).bindPopup("Batman Oil Field");
  L.marker([40.4, 49.9]).addTo(map).bindPopup("Caspian Block");
}
</script>

</body>
</html>
